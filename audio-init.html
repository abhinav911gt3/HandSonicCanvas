<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HandSonicCanvas Audio Init</title>
  <script src="https://cdn.jsdelivr.net/npm/tone@15.1.22/build/Tone.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    button { margin: 0.25em; padding: 0.5em 1em; font-size: 1em; }
    .piano-keys, .drum-buttons { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>HandSonicCanvas Audio Init</h1>

  <h2>Piano (PolySynth) - 61 Keys</h2>
  <div class="piano-keys" id="pianoKeys"></div>

  <h2>Drums (9 Sounds)</h2>
  <div class="drum-buttons">
    <button onclick="playKick()">Kick (C1)</button>
    <button onclick="playSnare()">Snare</button>
    <button onclick="playHiHatClosed()">Hi-Hat Closed</button>
    <button onclick="playHiHatOpen()">Hi-Hat Open</button>
    <button onclick="playTom1()">Tom 1</button>
    <button onclick="playTom2()">Tom 2</button>
    <button onclick="playTom3()">Tom 3</button>
    <button onclick="playCrash()">Crash Cymbal</button>
    <button onclick="playRide()">Ride Cymbal</button>
  </div>

  <script>
    let started = false;
    async function ensureStarted() {
      if (!started) {
        await Tone.start();
        started = true;
      }
    }

    // Piano PolySynth Setup
    const polySynth = new Tone.PolySynth(Tone.Synth, {
      oscillator: { type: 'triangle' },
      envelope: { attack: 0.01, decay: 0.3, sustain: 0.2, release: 1.2 }
    }).toDestination();

    // List of all 61 piano keys from C2 to C7
    const pianoKeys = [
      "C2", "C#2", "D2", "D#2", "E2", "F2", "F#2", "G2", "G#2", "A2", "A#2", "B2",
      "C3", "C#3", "D3", "D#3", "E3", "F3", "F#3", "G3", "G#3", "A3", "A#3", "B3",
      "C4", "C#4", "D4", "D#4", "E4", "F4", "F#4", "G4", "G#4", "A4", "A#4", "B4",
      "C5", "C#5", "D5", "D#5", "E5", "F5", "F#5", "G5", "G#5", "A5", "A#5", "B5",
      "C6", "C#6", "D6", "D#6", "E6", "F6", "F#6", "G6", "G#6", "A6", "A#6", "B6",
      "C7"
    ];

    // Render piano keys as buttons
    const pianoKeysContainer = document.getElementById("pianoKeys");
    pianoKeys.forEach(note => {
      const button = document.createElement("button");
      button.textContent = note;
      button.onclick = async () => {
        await ensureStarted();
        polySynth.triggerAttackRelease(note, "8n");
      };
      pianoKeysContainer.appendChild(button);
    });

    // Drum Synths Setup: separate synths for each drum sound
    const kick = new Tone.MembraneSynth().toDestination();
    const snare = new Tone.NoiseSynth({
      noise: { type: 'white' },
      envelope: { attack: 0.001, decay: 0.2, sustain: 0 }
    }).toDestination();
    const hiHatClosed = new Tone.MetalSynth({
      frequency: 400,
      envelope: { attack: 0.001, decay: 0.1, release: 0.01 },
      harmonicity: 5.1,
      modulationIndex: 32,
      resonance: 4000,
      octaves: 1.5
    }).toDestination();
    const hiHatOpen = new Tone.MetalSynth({
      frequency: 400,
      envelope: { attack: 0.01, decay: 0.3, release: 0.1 },
      harmonicity: 5.1,
      modulationIndex: 15,
      resonance: 3000,
      octaves: 1.5
    }).toDestination();
    const tom1 = new Tone.MembraneSynth().toDestination();
    const tom2 = new Tone.MembraneSynth().toDestination();
    const tom3 = new Tone.MembraneSynth().toDestination();
    const crash = new Tone.MetalSynth({
      frequency: 200,
      envelope: { attack: 0.001, decay: 1.5, release: 0.1 },
      harmonicity: 5.1,
      modulationIndex: 32,
      resonance: 1000,
      octaves: 3.5
    }).toDestination();
    const ride = new Tone.MetalSynth({
      frequency: 300,
      envelope: { attack: 0.001, decay: 1.2, release: 0.1 },
      harmonicity: 5.1,
      modulationIndex: 15,
      resonance: 3000,
      octaves: 3.5
    }).toDestination();

    // Drum play functions
    async function playKick() {
      await ensureStarted();
      kick.triggerAttackRelease("C1", "8n");
    }
    async function playSnare() {
      await ensureStarted();
      snare.triggerAttackRelease("8n");
    }
    async function playHiHatClosed() {
      await ensureStarted();
      hiHatClosed.triggerAttackRelease("16n");
    }
    async function playHiHatOpen() {
      await ensureStarted();
      hiHatOpen.triggerAttackRelease("16n");
    }
    async function playTom1() {
      await ensureStarted();
      tom1.triggerAttackRelease("D2", "8n");
    }
    async function playTom2() {
      await ensureStarted();
      tom2.triggerAttackRelease("F2", "8n");
    }
    async function playTom3() {
      await ensureStarted();
      tom3.triggerAttackRelease("A2", "8n");
    }
    async function playCrash() {
      await ensureStarted();
      crash.triggerAttackRelease("C3", "8n");
    }
    async function playRide() {
      await ensureStarted();
      ride.triggerAttackRelease("D3", "8n");
    }
  </script>
</body>
</html>
